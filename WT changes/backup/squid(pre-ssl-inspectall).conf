#debug_options all,3
########################################################
# squid.conf - generated by Titax
########################################################
visible_hostname wt513cw
# Increase the request header max size to 64K instead of default 10K
# Found that some apps seem to send headers of 12287 bytes (Seimens)
request_header_max_size 64 KB
http_port 10.1.2.93:8881 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/usr/blocker/ssl/ssl_cert/webtitan.pem
http_port 127.0.0.1:8881 

icp_port 0
append_domain .copperf.local
cache_effective_user nobody
#removed - This setting causes squid to ignore the auxiliary winbindd_priv group membership
#cache_effective_group nobody
coredump_dir /blocker/faultreports/
strip_query_terms off

########################################################
# config info for SSL mode
########################################################
acl ssl_tunnel dst -n "/blocker/proxy/etc/ssltunnels"
ssl_bump splice ssl_tunnel


sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER
sslcrtd_program /blocker/proxy/libexec/ssl_crtd -s /usr/blocker/ssl/ssl_db -M 4MB

acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3

acl ssl_file dstdomain "/blocker/proxy/etc/sslinspect"
acl ssl_regex dstdom_regex -i "/blocker/proxy/etc/sslinspectregex"
acl ssl_inspect any-of ssl_file ssl_regex
ssl_bump peek step1 all
ssl_bump bump step2 ssl_inspect
ssl_bump splice step2 all


sslproxy_options ALL
#sslproxy_cipher ECDHE-RSA-RC4-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA:DHE-RSA-CAMELLIA128-SHA:AES128-SHA:RC4-SHA:HIGH:!aNULL:!MD5:!ADH

acl snmppublic snmp_community public
snmp_port 3401
snmp_access allow all

#
########################################################
# Our cache settings
########################################################
cache_mem 256 MB
cache_swap_low      95
cache_swap_high     98
maximum_object_size 8192 KB
memory_pools off
cache_replacement_policy heap LFUDA
maximum_object_size_in_memory 50 KB
buffered_logs on
cache_dir aufs /cache 2282 16 256

########################################################
# Block streaming content
########################################################
acl audio rep_mime_type -i audio
acl video rep_mime_type -i video
http_reply_access allow audio
http_reply_access allow video
http_reply_access allow all
########################################################
# Make sure windows updates work, addition acls can be
# added before the inserter
########################################################
########################################################
# Our authenticators
########################################################
auth_param basic program /blocker/bin/proxy_auth.pl
auth_param basic children 20
auth_param basic realm Internet via WebTitan
auth_param basic credentialsttl 1 hour
acl titan_command titan_cmd REQUIRED
acl authenticated titan_auth REQUIRED
http_access deny titan_command
http_access allow authenticated
########################################################
# Our icap settings
########################################################
icap_enable on
icap_preview_enable on
icap_send_client_ip on
icap_send_client_username on
icap_service greasyspoon_resp respmod_precache 0 icap://127.0.0.1:1344/greasyspoon_resp
icap_class class_2 greasyspoon_resp
icap_access class_2 allow all
#icap_service pagescan respmod_precache bypass=1 icap://127.0.0.1:1344/
#adaptation_service_set filter_class pagescan
#adaptation_access filter_class deny audio
#adaptation_access filter_class deny video
#adaptation_access filter_class allow all
########################################################
# Other forward settings
########################################################
acl http-traffic proto HTTP
acl ssl-traffic proto HTTPS
acl connect-traffic method CONNECT
# Transparent SSL connections are always direct
acl ssl_port port 443
always_direct allow ssl_port
always_direct allow all

########################################################
# WCCP settings
########################################################

########################################################
# Other misc settings
########################################################
cache_log /var/log/proxy/cache.log
access_log none
logfile_rotate 0
pid_filename /var/run/squid.pid
shutdown_lifetime 10 seconds
half_closed_clients off
client_db off
ie_refresh on
dns_v4_first on

#
# SMP settings
#
workers 1
